# cinema

## Исходная задача

Необходимо написать REST сервис для бронирования мест в кинотеатрах.

Сервис должен иметь следующую функциональность:
1. Получение списка мест в зале со статусами свободно/забронировано. 
2. Бронирование одного или нескольких свободных мест в зале кинотеатра.

Примечания: 
1. Добавить недостающие по Вашему мнению методы в API (например: список 
кинотеатров, список залов в кинотеатре и прочее). 
2. Для реализации API можно использовать любой фреймворк. 
3. Для хранения данных использовать PostgreSQL или embedded db c SQL-
синтаксисом. 
4. При работе с базой использовать JDBC (не использовать ORM). 
5. Продемонстрировать работу API с помощью тестов. 
6. Обеспечить максимально простое развёртывание приложения (например 
docker-контейнер). 
7. Исходный код выложить на github или bitbucket.

## Описание сервиса

Перед вами backend сервиса для бронирования мест в кинотеатрах.

### Этапы разработки

1. Определяем пользовательские истории
2. Определить возможные допущения
3. Описываем доменную модель и основные команды
4. Описываем API по стандарту OpenAPI (http://openapis.org)

### Пользовательские сценарии

#### Администратор 1

Сценарий описывает типовые действия Администратора кинотеатра.
1. Создать кинотеатр
2. Создать два зала в кинотеатре
3. Создать тариф
4. Указать цены, входящие в состав тарифа
5. Описать раскладку мест в зале с учетом тарифа
6. Создать фильм
7. Создать сеанс фильма в определенном зале
8. Получить список свободных мест, убедиться, что все места пока свободны

#### Покупатель 1

Сценарий описывает типовые действия Покупателя билетов на сеанс

1. Получить список фильмов, выбрать филь
2. Получить список кинотеатров, где идет этот фильм, выбрать кинотеатр
3. Получить список сеансов фильма в кинотеатре, выбрать сеанс
4. Получить список свободных мест в зале на выбранный сеанс
5. Провести покупку билетов
6. Получить список свободных мест в зале на выбранный сеанс, убедиться, что места проданы

### Допущения

1. Считаем, что в кинотеатре всегда используется одна тарифная сетка.
То есть весь зал единожды разбит на сектора разной стоимости, если в этом
есть необходимость. Изменить разбивку по секторам невозможно. Разница в
стоимости достигается путем создания нового тарифа, где модно переопределить
стоимость каждого сектора.
2. Залы сложной формы, нестандартные места не учитываем. Считаем, что
все места в зале можно идентифицировать по признаку "X, Y" (Ряд, Место).
3. Все цены указаны в условных единицах "рублях"; задачу создания
международного сервиса бронирования мест в зале не ставим.
4. Список пользователей и администраторов оставляем за пределами системы.
При размещении заказа мы передаем ID пользователя, но самой базы пользователей
в разрабатываемом ПО нет.
5. Сервис работает без аутентификации, авторизации.

### Список микросервисов

#### 1. Кинотеатры (Cinema)

Информация о кинотеатрах меняется реже всего и хранится сколь угодно долго.

Информация хранится в PostgreSQL `Cinema`.

Вся информация о кинотеатре хранится в таблицах:
1. Кинотеатры (Cinema)
2. Залы (Hall)
3. Места в зале (Seat)
4. Тарифы (Tariff)
5. Цены (Price)

Параметры кинотеатра:
1. ID (autoincrement)
2. Name
3. City
4. Address
5. Timezone

Параметры зала:
1. ID (autoincrement)
2. CinemaID (REFERENCES Cinema)
3. Name

Параметры места
1. ID (autoincrement)
2. HallID (REFERENCES Hall)
3. X (Номер ряда)
4. Y (Номер места)
5. Sector (Номер в тарифной сетке)

Параметры тарифа
1. ID (autoincrement)
2. CinemaID (REFERENCES Cinema)
3. Name

Цены это сочетание цены и номера в тарифной сетке:
1. ID (autoincrement)
2. TariffID (REFERENCES Tariff)
3. Sector (Номер в тарифной сетке)
4. Price (Цена)

#### 2. Сеансы (Session)

Информация о сеансах постоянно дополняется, редко изменяется,
хранится не более определенного периода.

Информация хранится в PostgreSQL `Session`.

Вся информация о сеансах хранится в таблицах:
1. Фильмы (Film)
2. Сеансы (Session)

Параметры фильма
1. ID (autoincrement)
2. Name

Параметры сеанса
1. ID (autoincrement)
2. FilmID (REFERENCES Film)
3. HallID
4. Date (дата начала сеанса в нулевом часовом поясе)
5. TariffID

#### 3. Билеты (Ticket)

Больше всего данных хранится в сервисе продажи билетов. От Кинотеатров и Сеансов,
информацию о которых может менять один лишь администратор кинотеатра, Билеты 
доступны одновременно большому числу пользователей, чиь интересы сталкиваются
при покупке того или иного места.

Информация хранится в PostgreSQL `Ticket`.

Вся информация о билетах хранится в таблицах:
1. Заказы (Order)
2. Места в зале (Seat) и их статус (Sold, Reserved)

Параметры заказа
1. ID (autoincrement)
2. CustomerID
3. Status

Таблица мест в зале представляет собой таблицу, в которой выполняется
только вставка данных и последнее сообщение и представляет собой
актуальный статус места.
1. ID (autoincrement)
2. OrderID (REFERENCES Order)
3. SessionID
4. SeatID
5. Status (Sold, Reserved)

#### 4. Приложение (Application)

Внешнее API, которым будет пользоваться интернет магазин.

## Запуск

TODO

## Используемые технологии

TODO

## Список использованной литературы

1. Русскоязычное руководство по OpenAPI 3.0 https://starkovden.github.io/openapi-tutorial-overview.html
2. Официальное руководство http://spec.openapis.org/oas/v3.0.3
3. https://jsonapi.org/